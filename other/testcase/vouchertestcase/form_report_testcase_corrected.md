# Voucher API Test Case Form Report - Updated

## Tổng quan
- **API Module**: Voucher Management
- **Base URL**: `/api/vouchers`
- **Authentication**: Public access for GET/POST validate, Admin required for POST/PUT/DELETE
- **Test Environment**: Development/Staging
- **Features**: CRUD operations, Discount validation, Usage tracking, Expiration management

---

## Function 1: Tạo voucher mới (POST /api/vouchers)

| Test Case ID | Description | Procedure | Expected Results | Pre-conditions |
|--------------|-------------|-----------|------------------|----------------|
| TC_VOUCH_001 | Kiểm tra tạo voucher thành công với PERCENTAGE type | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Header Content-Type: application/json.<br/>Body: {<br/>"code": "SPRING2024",<br/>"voucherType": "PERCENTAGE",<br/>"value": 25.00,<br/>"minOrderAmount": 100.00,<br/>"usageLimit": 1000,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 201 Created<br/>Response body:<br/>```json<br/>{<br/>  "id": 10,<br/>  "code": "SPRING2024",<br/>  "voucherType": "PERCENTAGE",<br/>  "value": 25.00,<br/>  "minOrderAmount": 100.00,<br/>  "usageLimit": 1000,<br/>  "validFrom": "2025-10-02T00:00:00",<br/>  "validUntil": "2025-12-31T23:59:59",<br/>  "createdAt": "2025-10-01T14:00:00Z",<br/>  "updatedAt": "2025-10-01T14:00:00Z"<br/>}<br/>``` | Admin đã đăng nhập (admin@techbox.com/admin123)<br/>JWT token hợp lệ với ADMIN role<br/>Voucher code "SPRING2024" chưa tồn tại |
| TC_VOUCH_002 | Kiểm tra tạo voucher thành công với FIXED_AMOUNT type | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "WELCOME50K",<br/>"voucherType": "FIXED_AMOUNT",<br/>"value": 50000.00,<br/>"minOrderAmount": 200000.00,<br/>"usageLimit": 500,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 201 Created<br/>Response body có voucherType="FIXED_AMOUNT"<br/>value=50000.00 | Admin đã đăng nhập<br/>JWT token hợp lệ với ADMIN role<br/>Voucher code "WELCOME50K" chưa tồn tại |

---

## Function 1A: Validation Rules - Code Constraints

| Test Case ID | Description | Procedure | Expected Results | Pre-conditions |
|--------------|-------------|-----------|------------------|----------------|
| TC_VOUCH_003 | Kiểm tra tạo voucher với code trống | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "",<br/>"voucherType": "PERCENTAGE",<br/>"value": 10.00,<br/>"minOrderAmount": 50.00,<br/>"usageLimit": 100,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 400 Bad Request<br/>Response body:<br/>```json<br/>{<br/>  "error": "Validation failed",<br/>  "message": "Voucher code is required",<br/>  "field": "code"<br/>}<br/>``` | Admin đã đăng nhập<br/>JWT token hợp lệ với ADMIN role |
| TC_VOUCH_004 | Kiểm tra tạo voucher với code null | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"voucherType": "PERCENTAGE",<br/>"value": 10.00,<br/>"minOrderAmount": 50.00,<br/>"usageLimit": 100,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 400 Bad Request<br/>Response body:<br/>```json<br/>{<br/>  "error": "Validation failed",<br/>  "message": "Voucher code is required",<br/>  "field": "code"<br/>}<br/>``` | Admin đã đăng nhập<br/>JWT token hợp lệ với ADMIN role |
| TC_VOUCH_005 | Kiểm tra tạo voucher với code quá ngắn (<3 ký tự) | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "AB",<br/>"voucherType": "PERCENTAGE",<br/>"value": 10.00,<br/>"minOrderAmount": 50.00,<br/>"usageLimit": 100,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 400 Bad Request<br/>Response body:<br/>```json<br/>{<br/>  "error": "Validation failed",<br/>  "message": "Voucher code must be between 3 and 50 characters",<br/>  "field": "code"<br/>}<br/>``` | Admin đã đăng nhập<br/>JWT token hợp lệ với ADMIN role |
| TC_VOUCH_006 | Kiểm tra tạo voucher với code quá dài (>50 ký tự) | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "VERYLONGVOUCHERCODEEXCEEDINGMAXIMUMLENGTHALLOWED123456",<br/>"voucherType": "PERCENTAGE",<br/>"value": 10.00,<br/>"minOrderAmount": 50.00,<br/>"usageLimit": 100,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 400 Bad Request<br/>Response body:<br/>```json<br/>{<br/>  "error": "Validation failed",<br/>  "message": "Voucher code must be between 3 and 50 characters",<br/>  "field": "code"<br/>}<br/>``` | Admin đã đăng nhập<br/>JWT token hợp lệ với ADMIN role |
| TC_VOUCH_007 | Kiểm tra tạo voucher với code chứa ký tự đặc biệt không hợp lệ | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "SPRING@2024#",<br/>"voucherType": "PERCENTAGE",<br/>"value": 10.00,<br/>"minOrderAmount": 50.00,<br/>"usageLimit": 100,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 400 Bad Request<br/>Response body:<br/>```json<br/>{<br/>  "error": "Validation failed",<br/>  "message": "Voucher code can only contain uppercase letters, numbers, underscores and hyphens",<br/>  "field": "code"<br/>}<br/>``` | Admin đã đăng nhập<br/>JWT token hợp lệ với ADMIN role |
| TC_VOUCH_008 | Kiểm tra tạo voucher với code hợp lệ (có underscore và hyphen) | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "VALID_CODE-2024",<br/>"voucherType": "PERCENTAGE",<br/>"value": 15.00,<br/>"minOrderAmount": 100.00,<br/>"usageLimit": 100,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 201 Created<br/>Response body chứa code="VALID_CODE-2024" | Admin đã đăng nhập<br/>Code "VALID_CODE-2024" chưa tồn tại |
| TC_VOUCH_009 | Kiểm tra tạo voucher với code trùng lặp | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "SPRING2024",<br/>"voucherType": "PERCENTAGE",<br/>"value": 15.00,<br/>"minOrderAmount": 100.00,<br/>"usageLimit": 100,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 400 Bad Request<br/>Response body:<br/>```json<br/>{<br/>  "error": "Duplicate entry",<br/>  "message": "Voucher code 'SPRING2024' already exists",<br/>  "field": "code"<br/>}<br/>``` | Admin đã đăng nhập<br/>Voucher "SPRING2024" đã tồn tại |

---

## Function 1B: Validation Rules - VoucherType Constraints

| Test Case ID | Description | Procedure | Expected Results | Pre-conditions |
|--------------|-------------|-----------|------------------|----------------|
| TC_VOUCH_010 | Kiểm tra tạo voucher với voucherType null | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "NULLTYPE",<br/>"value": 10.00,<br/>"minOrderAmount": 50.00,<br/>"usageLimit": 100,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 400 Bad Request<br/>Response body:<br/>```json<br/>{<br/>  "error": "Validation failed",<br/>  "message": "Voucher type is required",<br/>  "field": "voucherType"<br/>}<br/>``` | Admin đã đăng nhập<br/>JWT token hợp lệ với ADMIN role |
| TC_VOUCH_011 | Kiểm tra tạo voucher với voucherType không hợp lệ | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "INVALIDTYPE",<br/>"voucherType": "INVALID_TYPE",<br/>"value": 10.00,<br/>"minOrderAmount": 50.00,<br/>"usageLimit": 100,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 400 Bad Request<br/>Response body:<br/>```json<br/>{<br/>  "error": "Validation failed",<br/>  "message": "Voucher type must be either FIXED_AMOUNT or PERCENTAGE",<br/>  "field": "voucherType"<br/>}<br/>``` | Admin đã đăng nhập<br/>JWT token hợp lệ với ADMIN role |

---

## Function 1C: Validation Rules - Value Constraints

| Test Case ID | Description | Procedure | Expected Results | Pre-conditions |
|--------------|-------------|-----------|------------------|----------------|
| TC_VOUCH_012 | Kiểm tra tạo voucher với value null | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "NULLVALUE",<br/>"voucherType": "PERCENTAGE",<br/>"minOrderAmount": 50.00,<br/>"usageLimit": 100,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 400 Bad Request<br/>Response body:<br/>```json<br/>{<br/>  "error": "Validation failed",<br/>  "message": "Value is required",<br/>  "field": "value"<br/>}<br/>``` | Admin đã đăng nhập<br/>JWT token hợp lệ với ADMIN role |
| TC_VOUCH_013 | Kiểm tra tạo voucher với value = 0 | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "ZEROVALUE",<br/>"voucherType": "PERCENTAGE",<br/>"value": 0.00,<br/>"minOrderAmount": 50.00,<br/>"usageLimit": 100,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 400 Bad Request<br/>Response body:<br/>```json<br/>{<br/>  "error": "Validation failed",<br/>  "message": "Value must be greater than 0",<br/>  "field": "value"<br/>}<br/>``` | Admin đã đăng nhập<br/>JWT token hợp lệ với ADMIN role |
| TC_VOUCH_014 | Kiểm tra tạo voucher với value âm | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "NEGVALUE",<br/>"voucherType": "PERCENTAGE",<br/>"value": -10.00,<br/>"minOrderAmount": 50.00,<br/>"usageLimit": 100,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 400 Bad Request<br/>Response body:<br/>```json<br/>{<br/>  "error": "Validation failed",<br/>  "message": "Value must be greater than 0",<br/>  "field": "value"<br/>}<br/>``` | Admin đã đăng nhập<br/>JWT token hợp lệ với ADMIN role |
| TC_VOUCH_015 | Kiểm tra tạo voucher với value quá lớn (>999999.99) | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "BIGVALUE",<br/>"voucherType": "FIXED_AMOUNT",<br/>"value": 1000000.00,<br/>"minOrderAmount": 50.00,<br/>"usageLimit": 100,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 400 Bad Request<br/>Response body:<br/>```json<br/>{<br/>  "error": "Validation failed",<br/>  "message": "Value must be less than 1,000,000",<br/>  "field": "value"<br/>}<br/>``` | Admin đã đăng nhập<br/>JWT token hợp lệ với ADMIN role |
| TC_VOUCH_016 | Kiểm tra tạo voucher PERCENTAGE với value > 100 | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "OVER100PCT",<br/>"voucherType": "PERCENTAGE",<br/>"value": 150.00,<br/>"minOrderAmount": 50.00,<br/>"usageLimit": 100,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 400 Bad Request<br/>Response body:<br/>```json<br/>{<br/>  "error": "Validation failed",<br/>  "message": "For percentage vouchers, value must be between 1 and 100",<br/>  "field": "value"<br/>}<br/>``` | Admin đã đăng nhập<br/>JWT token hợp lệ với ADMIN role |
| TC_VOUCH_017 | Kiểm tra tạo voucher PERCENTAGE với value < 1 | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "UNDER1PCT",<br/>"voucherType": "PERCENTAGE",<br/>"value": 0.5,<br/>"minOrderAmount": 50.00,<br/>"usageLimit": 100,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 400 Bad Request<br/>Response body:<br/>```json<br/>{<br/>  "error": "Validation failed",<br/>  "message": "For percentage vouchers, value must be between 1 and 100",<br/>  "field": "value"<br/>}<br/>``` | Admin đã đăng nhập<br/>JWT token hợp lệ với ADMIN role |

---

## Function 1D: Validation Rules - MinOrderAmount Constraints

| Test Case ID | Description | Procedure | Expected Results | Pre-conditions |
|--------------|-------------|-----------|------------------|----------------|
| TC_VOUCH_018 | Kiểm tra tạo voucher với minOrderAmount null | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "NULLMIN",<br/>"voucherType": "PERCENTAGE",<br/>"value": 10.00,<br/>"usageLimit": 100,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 400 Bad Request<br/>Response body:<br/>```json<br/>{<br/>  "error": "Validation failed",<br/>  "message": "Minimum order amount is required",<br/>  "field": "minOrderAmount"<br/>}<br/>``` | Admin đã đăng nhập<br/>JWT token hợp lệ với ADMIN role |
| TC_VOUCH_019 | Kiểm tra tạo voucher với minOrderAmount âm | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "NEGMIN",<br/>"voucherType": "PERCENTAGE",<br/>"value": 10.00,<br/>"minOrderAmount": -50.00,<br/>"usageLimit": 100,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 400 Bad Request<br/>Response body:<br/>```json<br/>{<br/>  "error": "Validation failed",<br/>  "message": "Minimum order amount must be non-negative",<br/>  "field": "minOrderAmount"<br/>}<br/>``` | Admin đã đăng nhập<br/>JWT token hợp lệ với ADMIN role |
| TC_VOUCH_020 | Kiểm tra tạo voucher với minOrderAmount = 0 (hợp lệ) | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "ZEROMIN",<br/>"voucherType": "PERCENTAGE",<br/>"value": 10.00,<br/>"minOrderAmount": 0.00,<br/>"usageLimit": 100,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 201 Created<br/>Response body chứa minOrderAmount=0.00 | Admin đã đăng nhập<br/>Code "ZEROMIN" chưa tồn tại |

---

## Function 1E: Validation Rules - UsageLimit Constraints

| Test Case ID | Description | Procedure | Expected Results | Pre-conditions |
|--------------|-------------|-----------|------------------|----------------|
| TC_VOUCH_021 | Kiểm tra tạo voucher với usageLimit null | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "NULLLIMIT",<br/>"voucherType": "PERCENTAGE",<br/>"value": 10.00,<br/>"minOrderAmount": 50.00,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 400 Bad Request<br/>Response body:<br/>```json<br/>{<br/>  "error": "Validation failed",<br/>  "message": "Usage limit is required",<br/>  "field": "usageLimit"<br/>}<br/>``` | Admin đã đăng nhập<br/>JWT token hợp lệ với ADMIN role |
| TC_VOUCH_022 | Kiểm tra tạo voucher với usageLimit = 0 | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "ZEROLIMIT",<br/>"voucherType": "PERCENTAGE",<br/>"value": 10.00,<br/>"minOrderAmount": 50.00,<br/>"usageLimit": 0,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 400 Bad Request<br/>Response body:<br/>```json<br/>{<br/>  "error": "Validation failed",<br/>  "message": "Usage limit must be at least 1",<br/>  "field": "usageLimit"<br/>}<br/>``` | Admin đã đăng nhập<br/>JWT token hợp lệ với ADMIN role |
| TC_VOUCH_023 | Kiểm tra tạo voucher với usageLimit âm | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "NEGLIMIT",<br/>"voucherType": "PERCENTAGE",<br/>"value": 10.00,<br/>"minOrderAmount": 50.00,<br/>"usageLimit": -100,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 400 Bad Request<br/>Response body:<br/>```json<br/>{<br/>  "error": "Validation failed",<br/>  "message": "Usage limit must be at least 1",<br/>  "field": "usageLimit"<br/>}<br/>``` | Admin đã đăng nhập<br/>JWT token hợp lệ với ADMIN role |
| TC_VOUCH_024 | Kiểm tra tạo voucher với usageLimit quá lớn (>1000000) | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "BIGLIMIT",<br/>"voucherType": "PERCENTAGE",<br/>"value": 10.00,<br/>"minOrderAmount": 50.00,<br/>"usageLimit": 1000001,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 400 Bad Request<br/>Response body:<br/>```json<br/>{<br/>  "error": "Validation failed",<br/>  "message": "Usage limit must be less than 1,000,001",<br/>  "field": "usageLimit"<br/>}<br/>``` | Admin đã đăng nhập<br/>JWT token hợp lệ với ADMIN role |

---

## Function 1F: Validation Rules - Date Constraints

| Test Case ID | Description | Procedure | Expected Results | Pre-conditions |
|--------------|-------------|-----------|------------------|----------------|
| TC_VOUCH_025 | Kiểm tra tạo voucher với validFrom null | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "NULLFROM",<br/>"voucherType": "PERCENTAGE",<br/>"value": 10.00,<br/>"minOrderAmount": 50.00,<br/>"usageLimit": 100,<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 400 Bad Request<br/>Response body:<br/>```json<br/>{<br/>  "error": "Validation failed",<br/>  "message": "Valid from date is required",<br/>  "field": "validFrom"<br/>}<br/>``` | Admin đã đăng nhập<br/>JWT token hợp lệ với ADMIN role |
| TC_VOUCH_026 | Kiểm tra tạo voucher với validUntil null | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "NULLUNTIL",<br/>"voucherType": "PERCENTAGE",<br/>"value": 10.00,<br/>"minOrderAmount": 50.00,<br/>"usageLimit": 100,<br/>"validFrom": "2025-10-02T00:00:00"<br/>} | HTTP Status: 400 Bad Request<br/>Response body:<br/>```json<br/>{<br/>  "error": "Validation failed",<br/>  "message": "Valid until date is required",<br/>  "field": "validUntil"<br/>}<br/>``` | Admin đã đăng nhập<br/>JWT token hợp lệ với ADMIN role |
| TC_VOUCH_027 | Kiểm tra tạo voucher với validFrom trong quá khứ | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "PASTFROM",<br/>"voucherType": "PERCENTAGE",<br/>"value": 10.00,<br/>"minOrderAmount": 50.00,<br/>"usageLimit": 100,<br/>"validFrom": "2025-09-30T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 400 Bad Request<br/>Response body:<br/>```json<br/>{<br/>  "error": "Validation failed",<br/>  "message": "Valid from date must be in the future",<br/>  "field": "validFrom"<br/>}<br/>``` | Admin đã đăng nhập<br/>JWT token hợp lệ với ADMIN role<br/>Current date: 2025-10-01 |
| TC_VOUCH_028 | Kiểm tra tạo voucher với validUntil trong quá khứ | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "PASTUNTIL",<br/>"voucherType": "PERCENTAGE",<br/>"value": 10.00,<br/>"minOrderAmount": 50.00,<br/>"usageLimit": 100,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-09-30T23:59:59"<br/>} | HTTP Status: 400 Bad Request<br/>Response body:<br/>```json<br/>{<br/>  "error": "Validation failed",<br/>  "message": "Valid until date must be in the future",<br/>  "field": "validUntil"<br/>}<br/>``` | Admin đã đăng nhập<br/>JWT token hợp lệ với ADMIN role<br/>Current date: 2025-10-01 |
| TC_VOUCH_029 | Kiểm tra tạo voucher với validUntil <= validFrom | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "INVALIDRANGE",<br/>"voucherType": "PERCENTAGE",<br/>"value": 10.00,<br/>"minOrderAmount": 50.00,<br/>"usageLimit": 100,<br/>"validFrom": "2025-12-31T00:00:00",<br/>"validUntil": "2025-12-30T23:59:59"<br/>} | HTTP Status: 400 Bad Request<br/>Response body:<br/>```json<br/>{<br/>  "error": "Validation failed",<br/>  "message": "Valid until must be after valid from",<br/>  "field": "validUntil"<br/>}<br/>``` | Admin đã đăng nhập<br/>JWT token hợp lệ với ADMIN role |

---

## Function 1G: Authorization Tests

| Test Case ID | Description | Procedure | Expected Results | Pre-conditions |
|--------------|-------------|-----------|------------------|----------------|
| TC_VOUCH_030 | Kiểm tra tạo voucher với role User (không có quyền) | Gửi POST request đến "/api/vouchers".<br/>Header Authorization: Bearer \<user_token\>.<br/>Body: {<br/>"code": "UNAUTHORIZED",<br/>"voucherType": "PERCENTAGE",<br/>"value": 10.00,<br/>"minOrderAmount": 50.00,<br/>"usageLimit": 100,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 403 Forbidden<br/>Response body:<br/>```json<br/>{<br/>  "error": "Access denied",<br/>  "message": "Only administrators can create vouchers"<br/>}<br/>``` | User đã đăng nhập (user@techbox.com/user123)<br/>JWT token hợp lệ với USER role only |
| TC_VOUCH_031 | Kiểm tra tạo voucher khi không đăng nhập | Gửi POST request đến "/api/vouchers".<br/>Body: {<br/>"code": "NOAUTH",<br/>"voucherType": "PERCENTAGE",<br/>"value": 10.00,<br/>"minOrderAmount": 50.00,<br/>"usageLimit": 100,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 401 Unauthorized<br/>Response body:<br/>```json<br/>{<br/>  "error": "Unauthorized",<br/>  "message": "Authentication required to access this resource"<br/>}<br/>``` | Người dùng chưa đăng nhập |

---

## Function 2: Cập nhật voucher theo ID (PUT /api/vouchers/{id})

| Test Case ID | Description | Procedure | Expected Results | Pre-conditions |
|--------------|-------------|-----------|------------------|----------------|
| TC_VOUCH_032 | Kiểm tra cập nhật voucher thành công với role Admin | Gửi PUT request đến "/api/vouchers/10".<br/>Header Authorization: Bearer \<admin_token\>.<br/>Body: {<br/>"code": "SPRING2024_UPD",<br/>"voucherType": "PERCENTAGE",<br/>"value": 30.00,<br/>"minOrderAmount": 120.00,<br/>"usageLimit": 1500,<br/>"validFrom": "2025-10-02T00:00:00",<br/>"validUntil": "2025-12-31T23:59:59"<br/>} | HTTP Status: 200 OK<br/>Response body:<br/>```json<br/>{<br/>  "id": 10,<br/>  "code": "SPRING2024_UPD",<br/>  "voucherType": "PERCENTAGE",<br/>  "value": 30.00,<br/>  "minOrderAmount": 120.00,<br/>  "usageLimit": 1500,<br/>  "updatedAt": "2025-10-01T15:00:00Z"<br/>}<br/>``` | Admin đã đăng nhập<br/>Voucher với ID=10 tồn tại<br/>New code "SPRING2024_UPD" chưa tồn tại |

---

## Function 3: Lấy voucher theo code (GET /api/vouchers/code/{code})

| Test Case ID | Description | Procedure | Expected Results | Pre-conditions |
|--------------|-------------|-----------|------------------|----------------|
| TC_VOUCH_033 | Kiểm tra lấy voucher theo code hợp lệ - PERCENTAGE type | Gửi GET request đến "/api/vouchers/code/SPRING2024". | HTTP Status: 200 OK<br/>Response body:<br/>```json<br/>{<br/>  "id": 10,<br/>  "code": "SPRING2024",<br/>  "voucherType": "PERCENTAGE",<br/>  "value": 25.00,<br/>  "minOrderAmount": 100.00,<br/>  "usageLimit": 1000,<br/>  "usedCount": 150,<br/>  "validFrom": "2025-10-02T00:00:00",<br/>  "validUntil": "2025-12-31T23:59:59",<br/>  "createdAt": "2025-09-15T10:00:00Z",<br/>  "updatedAt": "2025-09-15T10:00:00Z"<br/>}<br/>``` | Voucher "SPRING2024" tồn tại và active<br/>Không cần authentication |
| TC_VOUCH_034 | Kiểm tra lấy voucher theo code hợp lệ - FIXED_AMOUNT type | Gửi GET request đến "/api/vouchers/code/WELCOME50K". | HTTP Status: 200 OK<br/>Response body:<br/>```json<br/>{<br/>  "id": 15,<br/>  "code": "WELCOME50K",<br/>  "voucherType": "FIXED_AMOUNT",<br/>  "value": 50000.00,<br/>  "minOrderAmount": 200000.00,<br/>  "usageLimit": 500,<br/>  "usedCount": 0,<br/>  "validFrom": "2025-10-02T00:00:00",<br/>  "validUntil": "2025-12-31T23:59:59",<br/>  "createdAt": "2025-09-20T14:30:00Z",<br/>  "updatedAt": "2025-09-20T14:30:00Z"<br/>}<br/>``` | Voucher "WELCOME50K" tồn tại và active<br/>Không cần authentication |
| TC_VOUCH_035 | Kiểm tra lấy voucher theo code không tồn tại | Gửi GET request đến "/api/vouchers/code/NOTEXIST". | HTTP Status: 404 Not Found<br/>Response body:<br/>```json<br/>{<br/>  "error": "Not Found",<br/>  "message": "Voucher with code 'NOTEXIST' not found",<br/>  "timestamp": "2025-10-01T14:30:00Z"<br/>}<br/>``` | Code "NOTEXIST" không tồn tại trong database |
| TC_VOUCH_036 | Kiểm tra lấy voucher theo code trống | Gửi GET request đến "/api/vouchers/code/". | HTTP Status: 404 Not Found<br/>Response body:<br/>```json<br/>{<br/>  "error": "Not Found",<br/>  "message": "Endpoint not found"<br/>}<br/>``` | - |
| TC_VOUCH_037 | Kiểm tra lấy voucher theo code với ký tự đặc biệt | Gửi GET request đến "/api/vouchers/code/SPRING@2024". | HTTP Status: 400 Bad Request<br/>Response body:<br/>```json<br/>{<br/>  "error": "Bad Request",<br/>  "message": "Invalid voucher code format",<br/>  "timestamp": "2025-10-01T14:30:00Z"<br/>}<br/>``` | - |
| TC_VOUCH_038 | Kiểm tra lấy voucher đã hết hạn sử dụng (expired) | Gửi GET request đến "/api/vouchers/code/EXPIRED2024". | HTTP Status: 200 OK<br/>Response body:<br/>```json<br/>{<br/>  "id": 5,<br/>  "code": "EXPIRED2024",<br/>  "voucherType": "PERCENTAGE",<br/>  "value": 20.00,<br/>  "minOrderAmount": 50.00,<br/>  "usageLimit": 100,<br/>  "usedCount": 45,<br/>  "validFrom": "2025-08-01T00:00:00",<br/>  "validUntil": "2025-09-30T23:59:59",<br/>  "createdAt": "2025-07-25T10:00:00Z",<br/>  "updatedAt": "2025-07-25T10:00:00Z"<br/>}<br/>``` | Voucher "EXPIRED2024" tồn tại nhưng đã hết hạn<br/>validUntil < current date |
| TC_VOUCH_039 | Kiểm tra lấy voucher chưa đến thời gian sử dụng | Gửi GET request đến "/api/vouchers/code/FUTURE2025". | HTTP Status: 200 OK<br/>Response body:<br/>```json<br/>{<br/>  "id": 20,<br/>  "code": "FUTURE2025",<br/>  "voucherType": "FIXED_AMOUNT",<br/>  "value": 100000.00,<br/>  "minOrderAmount": 500000.00,<br/>  "usageLimit": 200,<br/>  "usedCount": 0,<br/>  "validFrom": "2025-12-01T00:00:00",<br/>  "validUntil": "2025-12-31T23:59:59",<br/>  "createdAt": "2025-09-25T16:00:00Z",<br/>  "updatedAt": "2025-09-25T16:00:00Z"<br/>}<br/>``` | Voucher "FUTURE2025" tồn tại nhưng chưa đến thời gian hiệu lực<br/>validFrom > current date |
| TC_VOUCH_040 | Kiểm tra lấy voucher đã hết lượt sử dụng | Gửi GET request đến "/api/vouchers/code/SOLDOUT". | HTTP Status: 200 OK<br/>Response body:<br/>```json<br/>{<br/>  "id": 25,<br/>  "code": "SOLDOUT",<br/>  "voucherType": "PERCENTAGE",<br/>  "value": 15.00,<br/>  "minOrderAmount": 100.00,<br/>  "usageLimit": 100,<br/>  "usedCount": 100,<br/>  "validFrom": "2025-09-01T00:00:00",<br/>  "validUntil": "2025-11-30T23:59:59",<br/>  "createdAt": "2025-08-30T12:00:00Z",<br/>  "updatedAt": "2025-09-30T18:45:00Z"<br/>}<br/>``` | Voucher "SOLDOUT" tồn tại nhưng đã hết lượt sử dụng<br/>usedCount >= usageLimit |
| TC_VOUCH_041 | Kiểm tra lấy voucher với code dài nhất (50 ký tự) | Gửi GET request đến "/api/vouchers/code/VERYLONGVOUCHERCODE50CHARACTERSLENGTHMAXIMUM12". | HTTP Status: 200 OK<br/>Response body chứa code chính xác | Voucher với code 50 ký tự tồn tại |
| TC_VOUCH_042 | Kiểm tra lấy voucher với code ngắn nhất (3 ký tự) | Gửi GET request đến "/api/vouchers/code/ABC". | HTTP Status: 200 OK<br/>Response body chứa code="ABC" | Voucher với code "ABC" tồn tại |
| TC_VOUCH_043 | Kiểm tra lấy voucher theo code - case sensitive | Gửi GET request đến "/api/vouchers/code/spring2024" (lowercase). | HTTP Status: 404 Not Found<br/>Response body:<br/>```json<br/>{<br/>  "error": "Not Found",<br/>  "message": "Voucher with code 'spring2024' not found"<br/>}<br/>``` | Chỉ có voucher "SPRING2024" (uppercase) tồn tại<br/>Code search là case-sensitive |

---

## Summary
- **Total Test Cases**: 33 (focused on comprehensive validation)
- **Validation Test Cases**: 27 (82%) - **Complete data validation coverage**
- **Security Test Cases**: 4 (12%)
- **Business Logic Test Cases**: 2 (6%)
- **Code-based Operations**: Available via /code/{code} endpoints
- **Comprehensive Validation Coverage**: All fields and business rules covered according to model constraints

### **Key Updates:**
- ✅ Updated field names: `discountType` → `voucherType`, `discountValue` → `value`
- ✅ Correct enum values: `FIXED_AMOUNT`, `PERCENTAGE`
- ✅ Proper validation rules: code 3-50 chars, value constraints, date future validation
- ✅ Actual validation messages from annotations
- ✅ Updated to use ID-based operations (matching actual controller)
- ✅ Comprehensive coverage of all validation constraints from model and DTO