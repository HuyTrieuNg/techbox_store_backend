{
	"info": {
		"_postman_id": "product-api-complete",
		"name": "03. Product API (Complete)",
		"description": "All 16 endpoints for product management including image upload/delete",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Get All Products",
			"event": [{
				"listen": "test",
				"script": {
					"exec": [
						"pm.test(\"Status code is 200\", () => pm.response.to.have.status(200));",
						"if (pm.response.json().length > 0) {",
						"    pm.collectionVariables.set(\"product_id\", pm.response.json()[0].id);",
						"}"
					]
				}
			}],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{base_url}}/api/products?includeDeleted=false",
					"host": ["{{base_url}}"],
					"path": ["api", "products"],
					"query": [{"key": "includeDeleted", "value": "false"}]
				}
			}
		},
		{
			"name": "Get Active Products",
			"request": {
				"method": "GET",
				"header": [],
				"url": "{{base_url}}/api/products/active"
			}
		},
		{
			"name": "Get Product By ID",
			"event": [{
				"listen": "test",
				"script": {
					"exec": [
						"pm.test(\"Status code is 200\", () => pm.response.to.have.status(200));"
					]
				}
			}],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{base_url}}/api/products/{{product_id}}?includeDeleted=false",
					"host": ["{{base_url}}"],
					"path": ["api", "products", "{{product_id}}"],
					"query": [{"key": "includeDeleted", "value": "false"}]
				}
			}
		},
		{
			"name": "Get Products By Category",
			"request": {
				"method": "GET",
				"header": [],
				"url": "{{base_url}}/api/products/category/{{category_id}}"
			}
		},
		{
			"name": "Get Products By Brand",
			"request": {
				"method": "GET",
				"header": [],
				"url": "{{base_url}}/api/products/brand/{{brand_id}}"
			}
		},
		{
			"name": "Search Products",
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{base_url}}/api/products/search?keyword=laptop",
					"host": ["{{base_url}}"],
					"path": ["api", "products", "search"],
					"query": [{"key": "keyword", "value": "laptop"}]
				}
			}
		},
		{
			"name": "Check Product Exists",
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{base_url}}/api/products/exists?name=Test Product",
					"host": ["{{base_url}}"],
					"path": ["api", "products", "exists"],
					"query": [{"key": "name", "value": "Test Product"}]
				}
			}
		},
		{
			"name": "Create Product (with FormData)",
			"event": [{
				"listen": "prerequest",
				"script": {
					"exec": [
						"pm.collectionVariables.set(\"test_product_name\", \"Product \" + Date.now());"
					]
				}
			},
			{
				"listen": "test",
				"script": {
					"exec": [
						"pm.test(\"Status code is 200 or 201\", () => pm.response.to.have.status.oneOf([200, 201]));",
						"if (pm.response.code <= 201) {",
						"    pm.collectionVariables.set(\"created_product_id\", pm.response.json().id);",
						"}"
					]
				}
			}],
			"request": {
				"method": "POST",
				"header": [
					{"key": "Authorization", "value": "Bearer {{access_token}}"}
				],
				"body": {
					"mode": "formdata",
					"formdata": [
						{"key": "name", "value": "{{test_product_name}}", "type": "text"},
						{"key": "description", "value": "Test product description", "type": "text"},
						{"key": "categoryId", "value": "{{category_id}}", "type": "text"},
						{"key": "brandId", "value": "{{brand_id}}", "type": "text"}
					]
				},
				"url": "{{base_url}}/api/products"
			}
		},
		{
			"name": "Update Product (with FormData)",
			"request": {
				"method": "PUT",
				"header": [
					{"key": "Authorization", "value": "Bearer {{access_token}}"}
				],
				"body": {
					"mode": "formdata",
					"formdata": [
						{"key": "name", "value": "{{test_product_name}} Updated", "type": "text"},
						{"key": "description", "value": "Updated description", "type": "text"}
					]
				},
				"url": "{{base_url}}/api/products/{{created_product_id}}"
			}
		},
		{
			"name": "Upload Product Image",
			"event": [{
				"listen": "test",
				"script": {
					"exec": [
						"pm.test(\"Status code is 200\", () => pm.response.to.have.status(200));",
						"pm.test(\"Response has image URL\", () => {",
						"    const res = pm.response.json();",
						"    pm.expect(res).to.have.property('secure_url');",
						"    pm.expect(res).to.have.property('public_id');",
						"    if (res.secure_url) {",
						"        pm.collectionVariables.set(\"uploaded_image_url\", res.secure_url);",
						"        pm.collectionVariables.set(\"uploaded_image_id\", res.public_id);",
						"    }",
						"});"
					]
				}
			}],
			"request": {
				"method": "POST",
				"header": [
					{"key": "Authorization", "value": "Bearer {{access_token}}"}
				],
				"body": {
					"mode": "formdata",
					"formdata": [
						{"key": "file", "type": "file", "src": ""}
					]
				},
				"url": "{{base_url}}/api/products/upload-image"
			}
		},
		{
			"name": "Delete Product Image",
			"request": {
				"method": "DELETE",
				"header": [
					{"key": "Authorization", "value": "Bearer {{access_token}}"}
				],
				"url": "{{base_url}}/api/products/{{product_id}}/image"
			}
		},
		{
			"name": "Delete Cloudinary Image",
			"request": {
				"method": "DELETE",
				"header": [
					{"key": "Authorization", "value": "Bearer {{access_token}}"}
				],
				"url": {
					"raw": "{{base_url}}/api/products/delete-image?publicId={{uploaded_image_id}}",
					"host": ["{{base_url}}"],
					"path": ["api", "products", "delete-image"],
					"query": [{"key": "publicId", "value": "{{uploaded_image_id}}"}]
				}
			}
		},
		{
			"name": "Create Product With Image",
			"request": {
				"method": "POST",
				"header": [
					{"key": "Authorization", "value": "Bearer {{access_token}}"}
				],
				"body": {
					"mode": "formdata",
					"formdata": [
						{"key": "name", "value": "Product With Image {{$timestamp}}", "type": "text"},
						{"key": "description", "value": "Product with uploaded image", "type": "text"},
						{"key": "categoryId", "value": "{{category_id}}", "type": "text"},
						{"key": "brandId", "value": "{{brand_id}}", "type": "text"},
						{"key": "image", "type": "file", "src": ""}
					]
				},
				"url": "{{base_url}}/api/products/create-with-image"
			}
		},
		{
			"name": "Update Product With Image",
			"request": {
				"method": "PUT",
				"header": [
					{"key": "Authorization", "value": "Bearer {{access_token}}"}
				],
				"body": {
					"mode": "formdata",
					"formdata": [
						{"key": "name", "value": "Updated Product With Image", "type": "text"},
						{"key": "description", "value": "Updated with new image", "type": "text"},
						{"key": "image", "type": "file", "src": ""}
					]
				},
				"url": "{{base_url}}/api/products/{{created_product_id}}/update-with-image"
			}
		},
		{
			"name": "Delete Product (Soft Delete)",
			"request": {
				"method": "DELETE",
				"header": [
					{"key": "Authorization", "value": "Bearer {{access_token}}"}
				],
				"url": "{{base_url}}/api/products/{{created_product_id}}"
			}
		},
		{
			"name": "Restore Product",
			"request": {
				"method": "PATCH",
				"header": [
					{"key": "Authorization", "value": "Bearer {{access_token}}"}
				],
				"url": "{{base_url}}/api/products/{{created_product_id}}/restore"
			}
		}
	],
	"variable": [
		{"key": "base_url", "value": "http://localhost:8080"},
		{"key": "access_token", "value": ""},
		{"key": "product_id", "value": "1"},
		{"key": "category_id", "value": "1"},
		{"key": "brand_id", "value": "1"},
		{"key": "created_product_id", "value": ""},
		{"key": "test_product_name", "value": ""},
		{"key": "uploaded_image_url", "value": ""},
		{"key": "uploaded_image_id", "value": ""}
	]
}
